<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- FORM de optica.graduacion -->
  <record id="view_graduacion_form" model="ir.ui.view">
    <field name="name">optica.graduacion.form</field>
    <field name="model">optica.graduacion</field>
    <field name="arch" type="xml">
      <form string="Historia Cl√≠nica - Examen Visual">
        <header>
          <button name="action_imprimir_historia_clinica"
                  string="Imprimir Historia Cl√≠nica" 
                  type="object"
                  class="btn-primary"/>
          <button name="action_calcular_distancia_vertice" 
                  type="object" 
                  string="Calcular Vertex LC" 
                  class="btn-secondary"
                  style="margin-left: 8px;"/>
          <button name="action_mostrar_notacion_bicilindrica" 
                  type="object" 
                  string="Notaci√≥n Bicil√≠ndrica" 
                  class="btn-secondary"
                  style="margin-left: 8px;"/>
        </header>
       
        <sheet>
          <notebook>

            <!-- PESTA√ëA 1: REFRACCI√ìN -->
            <page string="Refracci√≥n">
              <!-- DATOS GENERALES -->
              <group string="Datos Generales" col="2">
                <group>
                  <field name="paciente_id" class="graduacion-field"/>
                  <field name="fecha" class="graduacion-field"/>
                </group>
                <group>
                  <field name="profesional" class="graduacion-field"/>
                </group>
              </group>
              
              <!-- Diagn√≥stico y Tipo de Lente -->
              <group string="Diagn√≥stico Principal">
                <field name="diagnostico" class="graduacion-field"/>
                <field name="tipo_lente" class="graduacion-field"/>
              </group>
              
              <!-- Rx en dos columnas -->
              <group col="2">
                <group string="üëÅÔ∏è Ojo Derecho">
                  <field name="ojo_derecho_esfera" string="ESF" placeholder="0.00" class="graduacion-field"/>
                  <field name="ojo_derecho_cilindro" string="CIL" placeholder="0.00" class="graduacion-field"/>
                  <field name="ojo_derecho_eje" string="EJE" placeholder="0" class="graduacion-field"/>
                  <field name="ojo_derecho_av" string="AV" placeholder="20/20" class="graduacion-field"/>
                </group>

                <group string="üëÅÔ∏è Ojo Izquierdo">
                  <field name="ojo_izquierdo_esfera" string="ESF" placeholder="0.00" class="graduacion-field"/>
                  <field name="ojo_izquierdo_cilindro" string="CIL" placeholder="0.00" class="graduacion-field"/>
                  <field name="ojo_izquierdo_eje" string="EJE" placeholder="0" class="graduacion-field"/>
                  <field name="ojo_izquierdo_av" string="AV" placeholder="20/20" class="graduacion-field"/>
                </group>
              </group>
              
              <!-- Datos adicionales -->
              <group string="üìè Datos Adicionales" col="2">
                <group>
                  <field name="adicion" string="ADD" placeholder="0.00" class="graduacion-field"/>
                  <field name="distancia_nasopupilar_od" string="DNP OD" placeholder="0.0" class="graduacion-field"/>
                </group>
                <group>
                  <field name="distancia_interpupilar" string="DIP" placeholder="0.0" class="graduacion-field"/>
                  <field name="distancia_nasopupilar_oi" string="DNP OI" placeholder="0.0" class="graduacion-field"/>
                </group>
              </group>

              <!-- Altura Centro √ìptico -->
              <group>
                <field name="altura_centro_optico" string="Altura Centro √ìptico" placeholder="0.0" class="graduacion-field"/>
              </group>

              <!-- Observaciones -->
              <group>
                <field name="observaciones" string="Observaciones y Recomendaciones" 
                       placeholder="Escriba observaciones adicionales..." nolabel="1" 
                       class="graduacion-field"/>
              </group>
            </page>

            <!-- PESTA√ëA 2: DIAGN√ìSTICO AUTOM√ÅTICO -->
            <page string="Diagn√≥stico Autom√°tico">
              
              <!-- DIAGN√ìSTICO DETALLADO POR OJO -->
              <group string="ü©∫ DIAGN√ìSTICO DE ASTIGMATISMO" col="2">
                <group string="Ojo Derecho">
                  <label string="Tipo de Astigmatismo" class="text-success font-weight-bold"/>
                  <field name="diagnostico_od_detallado" readonly="1" nolabel="1" 
                         class="oe_read_only bg-light rounded p-2 border text-center font-weight-bold"/>
                  
                  <label string="Formaci√≥n de Focos" class="text-info font-weight-bold"/>
                  <field name="formacion_focos_od" readonly="1" nolabel="1" 
                         class="oe_read_only bg-primary text-white rounded p-2 text-center"/>
                  
                  <label string="Orientaci√≥n del Eje" class="text-warning font-weight-bold"/>
                  <field name="orientacion_od" readonly="1" nolabel="1" 
                         class="oe_read_only bg-info text-white rounded p-1 text-center"/>
                </group>
                
                <group string="Ojo Izquierdo">
                  <label string="Tipo de Astigmatismo" class="text-success font-weight-bold"/>
                  <field name="diagnostico_oi_detallado" readonly="1" nolabel="1" 
                         class="oe_read_only bg-light rounded p-2 border text-center font-weight-bold"/>
                  
                  <label string="Formaci√≥n de Focos" class="text-info font-weight-bold"/>
                  <field name="formacion_focos_oi" readonly="1" nolabel="1" 
                         class="oe_read_only bg-primary text-white rounded p-2 text-center"/>
                  
                  <label string="Orientaci√≥n del Eje" class="text-warning font-weight-bold"/>
                  <field name="orientacion_oi" readonly="1" nolabel="1" 
                         class="oe_read_only bg-info text-white rounded p-1 text-center"/>
                </group>
              </group>

              <!-- SERIES PARA LABORATORIO - SOLO OD Y OI -->
              <group string="üíé SERIES (PARA LABORATORIO)" col="2">
                <group string="Serie OD">
                  <field name="serie_recomendada_od" readonly="1" nolabel="1" 
                         class="oe_read_only bg-warning rounded p-2 text-center font-weight-bold"
                         attrs="{'invisible': [('serie_recomendada_od', '=', False)]}"/>
                  <label string="Para laboratorio - Ojo Derecho" class="text-center"/>
                </group>
                
                <group string="Serie OI">
                  <field name="serie_recomendada_oi" readonly="1" nolabel="1" 
                         class="oe_read_only bg-warning rounded p-2 text-center font-weight-bold"
                         attrs="{'invisible': [('serie_recomendada_oi', '=', False)]}"/>
                  <label string="Para laboratorio - Ojo Izquierdo" class="text-center"/>
                </group>
              </group>

              <!-- TRANSPOSICI√ìN -->
              <group string="üîÑ TRANSPOSICI√ìN DE LENTES" col="2">
                <group string="OD Transpuesto">
                  <field name="od_esfera_trans" string="ESF" readonly="1" class="graduacion-field"/>
                  <field name="od_cilindro_trans" string="CIL" readonly="1" class="graduacion-field"/>
                  <field name="od_eje_trans" string="EJE" readonly="1" class="graduacion-field"/>
                </group>
                <group string="OI Transpuesto">
                  <field name="oi_esfera_trans" string="ESF" readonly="1" class="graduacion-field"/>
                  <field name="oi_cilindro_trans" string="CIL" readonly="1" class="graduacion-field"/>
                  <field name="oi_eje_trans" string="EJE" readonly="1" class="graduacion-field"/>
                </group>
              </group>

            </page>

          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Vista Kanban -->
  <record id="view_graduacion_kanban" model="ir.ui.view">
    <field name="name">optica.graduacion.kanban</field>
    <field name="model">optica.graduacion</field>
    <field name="arch" type="xml">
      <kanban>
        <field name="id"/>
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click">
              <div class="o_kanban_record_title">
                <field name="paciente_id"/>
              </div>
              <div>
                <field name="fecha"/>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>
              
  <!-- Vista tipo √°rbol -->
  <record id="view_graduacion_tree" model="ir.ui.view">
    <field name="name">optica.graduacion.tree</field>
    <field name="model">optica.graduacion</field>
    <field name="arch" type="xml">
      <tree>
        <field name="paciente_id"/>
        <field name="fecha"/>
        <field name="diagnostico"/>
        <field name="ojo_derecho_esfera"/>
        <field name="ojo_izquierdo_esfera"/>
      </tree>
    </field>
  </record>

  <!-- Acci√≥n -->
  <record id="action_graduacion" model="ir.actions.act_window">
    <field name="name">Graduaciones</field>
    <field name="res_model">optica.graduacion</field>
    <field name="view_mode">tree,form,kanban</field>
    <field name="view_id" ref="view_graduacion_tree"/>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Crea tu primera graduaci√≥n de paciente
      </p>
    </field>
  </record>

  <menuitem id="menu_optica_root" name="√ìptica" sequence="10"/>
  <menuitem id="menu_graduaciones" name="Graduaciones"
            parent="menu_optica_root" action="action_graduacion" sequence="20"/>
		
  <!-- Pesta√±a en Contactos -->
  <record id="view_res_partner_form_inherit_graduaciones" model="ir.ui.view">
    <field name="name">res.partner.form.inherit.graduaciones</field>
    <field name="model">res.partner</field>
    <field name="inherit_id" ref="base.view_partner_form"/>
    <field name="arch" type="xml">
      <xpath expr="//page[@name='internal_notes']" position="after">
        <page string="Historial √ìptico">
          <field name="graduacion_ids">
            <tree>
              <field name="fecha"/>
              <field name="diagnostico"/>
              <field name="ojo_derecho_esfera"/>
              <field name="ojo_izquierdo_esfera"/>
              <field name="adicion"/>
            </tree>
          </field>
        </page>
      </xpath>
    </field>
  </record>
</odoo>
